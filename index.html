<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Dashboard - Accove CRM</title>
        <!--JQuery link-->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <!--JQuery Dialog link-->
        <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="author" content="Chris Allen">
        <link rel="stylesheet" href="main.css">
    </head>
    <body>
        <!--Dialog box start-->
        <div id="loginDialog" title="Login">
            <img id="dialogLogo" src="accoveLogoV2.png" alt="Accove Logo">
            <p>Log in to continue</p>
            <!--Login form table start-->
            <table id="loginForm">
                <tr>
                    <td id="username">Username: </td>
                    <td id="usernameInput"><input type="text" placeholder="Enter username"></td>
                </tr>
                <tr>
                    <td id="password">Password: </td>
                    <td id="passwordInput"><input type="text" placeholder="Enter password"></td>
                </tr>
            </table>
                <!--Login form table end-->
        </div>
            <!--Dialog box end-->
        
        <header>
            <img class="headerLogo" src="accoveLogo.png" alt="Accove logo">
            <img class="searchIcon" src="search.png" alt="Search icon">
            <input type="text" placeholder="  Search">
            <p class="dateTime"></p>
            <img class="supportIcon" src="support.png" alt="Support icon">
            <img class="notificationsIcon" src="notifications.png" alt="">
            <img class="appsIcon" src="apps.png" alt="">
            <img class="profileIcon" src="profile.png" alt="Profile icon">
        </header>
        <div class="pageLayout">
            <!--navigation Start-->
            <div class="navigation">
                <ul>
                    <li>
                        <p>Home</p>
                    </li>
                    <li>
                        <p><a href="#dashboard" id="dashboard">Dashboard</a></p>
                    </li>
                    <li>
                        <p>Lead Management</p>
                    </li>
                    <li>
                        <p><a href="#customer" id="customer">Customer Management</a></p>
                    </li>
                    <li>
                        <p>Workflow Automation</p>
                    </li>
                    <li>
                        <p>Automatic Quote System</p>
                    </li>
                    <li>
                        <p><a href="#staff" id="staff">Staff Tracking</a></p>
                    </li>
                    <li>
                        <p><a href="#projects" id="projects">Project Tracking</a></p>
                    </li>
                    <li>
                        <p>Interaction Tracking</p>
                    </li>
                </ul>
            </div>
                <!--navigation End-->
            <!--mainContent Start-->
            <div class="mainContent">
                <!--dashboardGrid Start-->
                <div id="dashboardGrid">
                    <!--invoicesContainer Start-->
                    <section id="invoicesContainer">
                        <h3>Invoices</h3>
                        <div id="invoicesFilters">
                            <ul>
                                <li>All</li>
                                <li>Open</li>
                                <li>Pending</li>
                                <li>Closed</li>
                            </ul>
                            <!--invoicesTable Start-->
                            <table id="invoicesTable">
                                <tr>
                                    <th id="customerColumn">Customer</th>
                                    <th id="companyColumn">Company</th>
                                    <th id="valueColumn">Value</th>
                                    <th id="statusColumn">Status</th>
                                </tr>
                                <tr>
                                    <td>Sam Smith</td>
                                    <td>Accove</td>
                                    <td>$1200</td>
                                    <td>Pending</td>
                                </tr>
                                <tr>
                                    <td>Christian Gray</td>
                                    <td>Accove</td>
                                    <td>$500</td>
                                    <td>Open</td>
                                </tr>
                                <tr>
                                    <td>Amy Shark</td>
                                    <td>Sandoz</td>
                                    <td>$120</td>
                                    <td>Open</td>
                                </tr>
                                <tr>
                                    <td>Bob Marley</td>
                                    <td>IBM</td>
                                    <td>$1500</td>
                                    <td>Pending</td>
                                </tr>
                                <tr>
                                    <td>Johnny Cash</td>
                                    <td>Maple Cafe</td>
                                    <td>$500</td>
                                    <td>Closed</td>
                                </tr>
                                <tr>
                                    <td>Harry Styles</td>
                                    <td>One Direction</td>
                                    <td>$600</td>
                                    <td>Closed</td>
                                </tr>
                                <tr>
                                    <td>Joe Dirt</td>
                                    <td>Caravan Park</td>
                                    <td>$50</td>
                                    <td>Open</td>
                                </tr>
                                <tr>
                                    <td>Molly Meldrum</td>
                                    <td>Country Records</td>
                                    <td>$120</td>
                                    <td>Pending</td>
                                </tr>
                                <tr>
                                    <td>Oscar Wilde</td>
                                    <td>Specsavers</td>
                                    <td>$760</td>
                                    <td>Pending</td>
                                </tr>
                                <tr>
                                    <td>Isaac Heeney</td>
                                    <td>Sydney Swans</td>
                                    <td>$3000</td>
                                    <td>Closed</td>
                                </tr>
                                <tr>
                                    <td>Buddy Franklin</td>
                                    <td>Hawthorn Hawks</td>
                                    <td>$5000</td>
                                    <td>Closed</td>
                                </tr>
                                <tr>
                                    <td>Owen Wilson</td>
                                    <td>Hollywood</td>
                                    <td>$700</td>
                                    <td>Pending</td>
                                </tr>
                                <tr>
                                    <td>Clint Eastwood</td>
                                    <td>Texas Sherrif</td>
                                    <td>$1000</td>
                                    <td>Open</td>
                                </tr>
                                <tr>
                                    <td>Sam Smith</td>
                                    <td>Accove</td>
                                    <td>$1200</td>
                                    <td>Pending</td>
                                </tr>
                            </table>
                                <!--invoicesTable End-->
                        </div>
                    </section>
                        <!--invoicesContainer End-->
                    <!--customerTrackingContainer Start-->
                    <section id="customerTrackingContainer">
                        <h3>Customer Tracking</h3>
                        <div id="customerTrackingGraph">
                            <img id="customerTrackingGraphImg" src="customerTrackingGraph.jpg" alt="">
                            <div id="customerTrackingText">
                                <p>Total Customers: 1234</p>
                                <p>Active: 700</p>
                                <p>Inactive: 500</p>
                            </div>
                        </div>
                    </section>
                        <!--customerTrackingContainer End-->
                    <!--openLeads Start-->
                    <section id="openLeadsContainer">
                        <h3>Current Open Leads</h3>
                        <table id="currentLeadsTable">
                            <tr>
                                <th id="leadsCustomer">Customer</th>
                                <th id="leadsAssigned">Assigned To</th>
                                <th id="leadsContact">Contact</th>
                            </tr>
                            <tr>
                                <td>Andrew Garfield</td>
                                <td>Chris Allen</td>
                                <td>0412 345 678</td>
                            </tr>
                            <tr>
                                <td>Michael Myers</td>
                                <td>Chris Allen</td>
                                <td>0412 345 678</td>
                            </tr>
                            <tr>
                                <td>Harrison Ford</td>
                                <td>Chris Allen</td>
                                <td>0412 345 678</td>
                            </tr>
                            <tr>
                                <td>Luke Skywalker</td>
                                <td>Chris Allen</td>
                                <td>0412 345 678</td>
                            </tr>
                            <tr>
                                <td>Peter Parker</td>
                                <td>Chris Allen</td>
                                <td>0412 345 678</td>
                            </tr>
                            <tr>
                                <td>Bruce Wayne</td>
                                <td>Jim Gordon</td>
                                <td>0412 345 678</td>
                            </tr>
                        </table>
                    </section>
                        <!--openLeads End-->
                </div>
                    <!--dashboard End-->
            </div>
                <!--mainContent End-->
        </div>
        <footer>
            <p>&copy; Copyright Accove 2024</p>
            <p>Uicons by <a href="https://www.flaticon.com/uicons">Flaticon</a></p>
        </footer>
        <script>
            $(function() {
                // Predefined test username
                const testUsername = "admin";
                // Predefined test password
                const testPassword = "password123";

                // Initialise the jQuery login dialog
                $("#loginDialog").dialog({
                    width: 900,
                    height: 550,
                    buttons: {
                        Submit: function() {
                            // Get values from input fields and assign to variables
                            const usernameEntered = $("#usernameInput input").val().trim();
                            const passwordEntered = $("#passwordInput input").val().trim();

                            // Check input values against predefined
                            if (usernameEntered === testUsername && passwordEntered === testPassword) {
                                $(this).dialog("close");
                            } else {
                                // Display error message if values don't match
                                alert("Invalid username or password. Please try again.");
                            }
                        }
                    },
                    close: function() {
                        $(".navigation, .mainContent").removeClass("blur");
                        loadPageFromHash();
                    },
                    open: function() {
                        $(".navigation, .mainContent").addClass("blur");
                    },
                    create: function () {
                        $(this).closest(".ui-dialog").find(".ui-dialog-buttonpane button:contains('Submit')").addClass("submitButton");
                    }
                });

                // Function to load content based on current hash in URL
                function loadPageFromHash() {
                    if (window.location.hash) {
                        // Creates new variable with content from address after #
                        var loadContent = window.location.hash.substr(1);
                        // Displays content from relevant page in mainContent div
                        $(".mainContent").load(loadContent + ".html", function() {
                            attachEventListenersToExistingCheckboxes();
                            attachRowClickListeners();
                        });
                    }
                }
                
                // Selects all <a> elements in navigation
                $(".navigation a").click(function() {
                    // Stores ID of clicked element
                    var pageLoad = $(this).attr("id");
                    window.location.hash = pageLoad;
                    loadPageFromHash();
                });

                // Load content on page load if there's a hash present
                loadPageFromHash();

                // Listen for hash changes
                window.onhashchange = function() {
                    loadPageFromHash();
                }
            });
            
            const dateTimeElement = document.querySelector(".dateTime");

            function updateDateTime() {
                const now = new Date();
                dateTimeElement.textContent = now.toLocaleString();
            };

            setInterval(updateDateTime, 1000);

            function addInputRow(){
                var table = document.getElementById("activeCustomersTable");
                var rowCount = table.rows.length;
                var customerCount = rowCount - 1;
                var row = table.insertRow(rowCount - 1);

                var checkBox = row.insertCell(0);
                var user = row.insertCell(1);
                var email = row.insertCell(2);
                var phone = row.insertCell(3);
                var company = row.insertCell(4);

                checkBox.innerHTML = `<input type="checkbox" name="user${customerCount}">`;

                checkBox.querySelector('input[type="checkbox"]').addEventListener('change', handleCheckboxChange);

                user.innerHTML = '<input type="text" class="userInput" placeholder="Name . . .">';
                email.innerHTML = '<input type="text" class="emailInput" placeholder="Email . . .">';
                phone.innerHTML = '<input type="text" class="phoneInput" placeholder="Phone . . .">';
                company.innerHTML = '<input type="text" class="companyInput" placeholder="Company . . .">';

                // Selects all elements in row that match 'text' type then iterates over each
                row.querySelectorAll('input[type="text"]').forEach(function(input) {
                    input.addEventListener('blur', function() {
                        // Check if all input fields have been filled with something
                        var allInputFilled = true;
                        row.querySelectorAll('input[type="text"]').forEach(function(input) {
                            if (input.value.trim() === '') {
                                allInputFilled = false;
                            }
                        });

                        // If all input fields have been filled with something, convert the content into cells
                        if (allInputFilled) {
                            // Calls the validateUserInput function
                            validateUserInput();
                            validatePhoneInput();
                            row.querySelectorAll('input[type="text"]').forEach(function(input) {
                                var cell = input.parentElement;
                                cell.innerHTML = input.value;
                            });
                        }
                    });
                });

                function validateUserInput() {
                    // Creates variable to store userInput input field
                    const userInput = document.getElementsByClassName("userInput")[0];
                    // Creates variable to store value of userInput
                    userInputValue = userInput.value;

                    // Creates the expression being used to compare the input against
                    const regex = /^[a-zA-Z]+(?: [a-zA-Z]+)?$/;

                    // Performs test of userInputValue against regex
                    if (!regex.test(userInputValue)) {
                        // Displays alert window
                        alert("Please enter only letters when entering a name.");
                        userInputValue.focus();
                    }
                };

                function validatePhoneInput() {
                    const phoneInput = document.getElementsByClassName("phoneInput")[0];
                    phoneInputValue = phoneInput.value;

                    const regex = /^[0-9]+$/;

                    if (!regex.test(phoneInputValue)) {
                        alert("Please enter only numbers when entering a phone number.");
                        phoneInputValue.focus();
                    }
                };
            };

            // Function that hangles change of state for all checkboxes
            function handleCheckboxChange(event) {
                if (event.target.checked) {
                    console.log(`Checkbox ${event.target.name} is checked`);
                } else {
                    console.log(`Checkbox ${event.target.name} is unchecked`);
                }
            };

            // Function that attaches checkbox event listeners to all existing checkboxes
            function attachEventListenersToExistingCheckboxes() {
                const activeCheckboxes = document.querySelectorAll('#activeCustomersTable input[type="checkbox"]');
                activeCheckboxes.forEach(function(checkbox) {
                    checkbox.addEventListener('change', handleCheckboxChange);
                });
            };

            // Attaches event listeners to checkboxes when the page loads
            window.onload = function() {
                attachEventListenersToExistingCheckboxes();
            };

            function addInactiveInputRow() {
                var table = document.getElementById("inactiveCustomersTable");
                var rowCount = table.rows.length;
                var row = table.insertRow(rowCount - 1);

                var checkBox = row.insertCell(0);
                var user = row.insertCell(1);
                var email = row.insertCell(2);
                var phone = row.insertCell(3);
                var company = row.insertCell(4);

                checkBox.innerHTML = '<input type="checkbox">';
                user.innerHTML = '<input type="text" class="inactiveUserInput" placeholder="Name . . .">';
                email.innerHTML = '<input type="text" class="inactiveEmailInput" placeholder="Email . . .">';
                phone.innerHTML = '<input type="text" class="inactivePhoneInput" placeholder="Phone . . .">';
                company.innerHTML = '<input type="text" class="inactiveCompanyInput">';

                row.querySelectorAll('input[type="text"]').forEach(function(input) {
                    input.addEventListener('blur', function() {
                        var allInactiveInputFilled = true;
                        row.querySelectorAll('input[type="text"]').forEach(function(input) {
                            if (input.value.trim() === '') {
                                allInactiveInputFilled = false;
                            }
                        });

                        if (allInactiveInputFilled) {
                            validateInactiveUserInput();
                            validateInactivePhoneInput();
                            row.querySelectorAll('input[type="text"]').forEach(function(input) {
                                var cell = input.parentElement;
                                cell.innerHTML = input.value;
                            });
                        }
                    });
                });

                function validateInactiveUserInput() {
                    const inactiveUserInput = document.getElementsByClassName("inactiveUserInput")[0];
                    inactiveUserInputValue = inactiveUserInput.value;

                    const regex = /^[a-zA-Z]+(?: [a-zA-Z]+)?$/;

                    if (!regex.test(inactiveUserInputValue)) {
                        alert("Please enter only letters when entering a name.");
                        inactiveUserInputValue.focus();
                    }
                };

                function validateInactivePhoneInput() {
                    const inactivePhoneInput = document.getElementsByClassName("inactivePhoneInput")[0];
                    inactivePhoneInputValue = inactivePhoneInput.value;

                    const regex = /^[0-9]+$/;

                    if (!regex.test(inactivePhoneInputValue)) {
                        alert("Please enter only numbers when entering a phone number.");
                        inactivePhoneInputValue.focus();
                    }
                };
            };
        </script>
    </body>
</html>